/*
 * Copyright (C) 2015-2016, Michiel Sikma <michiel@sikma.org>
 * MIT License
 */

#include <math.h>

#include "src/utils/math.h"

/**
 * Sine lookup table for the range [0..360].
 */
const float sin_table[] = {
    0.0,
    0.01745240643728351, 0.03489949670250097, 0.052335956242943835,
    0.0697564737441253, 0.08715574274765817, 0.10452846326765347,
    0.12186934340514748, 0.13917310096006544, 0.15643446504023087,
    0.17364817766693033, 0.1908089953765448, 0.20791169081775934,
    0.224951054343865, 0.24192189559966773, 0.25881904510252074,
    0.27563735581699916, 0.29237170472273677, 0.3090169943749474,
    0.3255681544571567, 0.3420201433256687, 0.35836794954530027,
    0.374606593415912, 0.39073112848927377, 0.4067366430758002,
    0.42261826174069944, 0.4383711467890774, 0.45399049973954675,
    0.4694715627858908, 0.48480962024633706,
    0.5,
    0.5150380749100542, 0.5299192642332049, 0.5446390350150271,
    0.5591929034707469, 0.573576436351046, 0.5877852522924731,
    0.6018150231520483, 0.6156614753256583, 0.6293203910498374,
    0.6427876096865393, 0.6560590289905073, 0.6691306063588582,
    0.6819983600624985, 0.6946583704589973, 0.7071067811865475,
    0.7193398003386511, 0.7313537016191705, 0.7431448254773942,
    0.7547095802227719, 0.766044443118978, 0.7771459614569708,
    0.7880107536067219, 0.7986355100472928, 0.8090169943749473,
    0.8191520442889917, 0.8290375725550416, 0.838670567945424,
    0.848048096156426, 0.8571673007021123, 0.8660254037844386,
    0.8746197071393957, 0.8829475928589269, 0.8910065241883678,
    0.898794046299167, 0.9063077870366499, 0.9135454576426009,
    0.9205048534524404, 0.9271838545667874, 0.9335804264972017,
    0.9396926207859083, 0.9455185755993167, 0.9510565162951535,
    0.9563047559630354, 0.9612616959383189, 0.9659258262890683,
    0.9702957262759965, 0.9743700647852352, 0.9781476007338056,
    0.981627183447664, 0.984807753012208, 0.9876883405951378,
    0.9902680687415704, 0.992546151641322, 0.9945218953682733,
    0.9961946980917455, 0.9975640502598242, 0.9986295347545738,
    0.9993908270190958, 0.9998476951563913,
    1.0,
    0.9998476951563913, 0.9993908270190958, 0.9986295347545738,
    0.9975640502598242, 0.9961946980917455, 0.9945218953682733,
    0.9925461516413221, 0.9902680687415704, 0.9876883405951378,
    0.984807753012208, 0.981627183447664, 0.9781476007338057,
    0.9743700647852352, 0.9702957262759965, 0.9659258262890683,
    0.9612616959383189, 0.9563047559630355, 0.9510565162951536,
    0.9455185755993168, 0.9396926207859084, 0.9335804264972017,
    0.9271838545667874, 0.9205048534524403, 0.9135454576426009,
    0.90630778703665, 0.8987940462991669, 0.8910065241883679,
    0.8829475928589269, 0.8746197071393959, 0.8660254037844388,
    0.8571673007021123, 0.8480480961564261, 0.838670567945424,
    0.8290375725550418, 0.8191520442889917, 0.8090169943749475,
    0.7986355100472928, 0.788010753606722, 0.7771459614569711,
    0.7660444431189781, 0.7547095802227721, 0.7431448254773942,
    0.7313537016191707, 0.7193398003386511, 0.7071067811865476,
    0.6946583704589971, 0.6819983600624985, 0.6691306063588583,
    0.6560590289905073, 0.6427876096865395, 0.6293203910498374,
    0.6156614753256584, 0.6018150231520482, 0.5877852522924732,
    0.5735764363510459, 0.5591929034707469, 0.5446390350150273,
    0.5299192642332049, 0.5150380749100544,
    0.5,
    0.48480962024633717, 0.4694715627858907, 0.45399049973954686,
    0.4383711467890773, 0.4226182617406995, 0.40673664307580043,
    0.39073112848927377, 0.37460659341591224, 0.3583679495453002,
    0.3420201433256689, 0.3255681544571566, 0.3090169943749475,
    0.2923717047227366, 0.2756373558169992, 0.258819045102521,
    0.24192189559966773, 0.2249510543438652, 0.2079116908177593,
    0.19080899537654497, 0.17364817766693025, 0.15643446504023098,
    0.1391731009600653, 0.12186934340514755, 0.10452846326765373,
    0.0871557427476582, 0.06975647374412552, 0.05233595624294381,
    0.03489949670250114, 0.017452406437283435,
    0.0,
    -0.01745240643728351, -0.03489949670250097, -0.052335956242943835,
    -0.0697564737441253, -0.08715574274765817, -0.10452846326765347,
    -0.12186934340514748, -0.13917310096006544, -0.15643446504023087,
    -0.17364817766693033, -0.1908089953765448, -0.20791169081775934,
    -0.224951054343865, -0.24192189559966773, -0.25881904510252074,
    -0.27563735581699916, -0.29237170472273677, -0.3090169943749474,
    -0.3255681544571567, -0.3420201433256687, -0.35836794954530027,
    -0.374606593415912, -0.39073112848927377, -0.4067366430758002,
    -0.42261826174069944, -0.4383711467890774, -0.45399049973954675,
    -0.4694715627858908, -0.48480962024633706,
    -0.5,
    -0.5150380749100542, -0.5299192642332049, -0.5446390350150271,
    -0.5591929034707469, -0.573576436351046, -0.5877852522924731,
    -0.6018150231520483, -0.6156614753256583, -0.6293203910498374,
    -0.6427876096865393, -0.6560590289905073, -0.6691306063588582,
    -0.6819983600624985, -0.6946583704589973, -0.7071067811865475,
    -0.7193398003386511, -0.7313537016191705, -0.7431448254773942,
    -0.7547095802227719, -0.766044443118978, -0.7771459614569708,
    -0.7880107536067219, -0.7986355100472928, -0.8090169943749473,
    -0.8191520442889917, -0.8290375725550416, -0.838670567945424,
    -0.848048096156426, -0.8571673007021123, -0.8660254037844386,
    -0.8746197071393957, -0.8829475928589269, -0.8910065241883678,
    -0.898794046299167, -0.9063077870366499, -0.9135454576426009,
    -0.9205048534524404, -0.9271838545667874, -0.9335804264972017,
    -0.9396926207859083, -0.9455185755993167, -0.9510565162951535,
    -0.9563047559630354, -0.9612616959383189, -0.9659258262890683,
    -0.9702957262759965, -0.9743700647852352, -0.9781476007338056,
    -0.981627183447664, -0.984807753012208, -0.9876883405951378,
    -0.9902680687415704, -0.992546151641322, -0.9945218953682733,
    -0.9961946980917455, -0.9975640502598242, -0.9986295347545738,
    -0.9993908270190958, -0.9998476951563913,
    -1.0,
    -0.9998476951563913, -0.9993908270190958, -0.9986295347545738,
    -0.9975640502598242, -0.9961946980917455, -0.9945218953682733,
    -0.9925461516413221, -0.9902680687415704, -0.9876883405951378,
    -0.984807753012208, -0.981627183447664, -0.9781476007338057,
    -0.9743700647852352, -0.9702957262759965, -0.9659258262890683,
    -0.9612616959383189, -0.9563047559630355, -0.9510565162951536,
    -0.9455185755993168, -0.9396926207859084, -0.9335804264972017,
    -0.9271838545667874, -0.9205048534524403, -0.9135454576426009,
    -0.90630778703665, -0.8987940462991669, -0.8910065241883679,
    -0.8829475928589269, -0.8746197071393959, -0.8660254037844388,
    -0.8571673007021123, -0.8480480961564261, -0.838670567945424,
    -0.8290375725550418, -0.8191520442889917, -0.8090169943749475,
    -0.7986355100472928, -0.788010753606722, -0.7771459614569711,
    -0.7660444431189781, -0.7547095802227721, -0.7431448254773942,
    -0.7313537016191707, -0.7193398003386511, -0.7071067811865476,
    -0.6946583704589971, -0.6819983600624985, -0.6691306063588583,
    -0.6560590289905073, -0.6427876096865395, -0.6293203910498374,
    -0.6156614753256584, -0.6018150231520482, -0.5877852522924732,
    -0.5735764363510459, -0.5591929034707469, -0.5446390350150273,
    -0.5299192642332049, -0.5150380749100544,
    -0.5,
    -0.48480962024633717, -0.4694715627858907, -0.45399049973954686,
    -0.4383711467890773, -0.4226182617406995, -0.40673664307580043,
    -0.39073112848927377, -0.37460659341591224, -0.3583679495453002,
    -0.3420201433256689, -0.3255681544571566, -0.3090169943749475,
    -0.2923717047227366, -0.2756373558169992, -0.258819045102521,
    -0.24192189559966773, -0.2249510543438652, -0.2079116908177593,
    -0.19080899537654497, -0.17364817766693025, -0.15643446504023098,
    -0.1391731009600653, -0.12186934340514755, -0.10452846326765373,
    -0.0871557427476582, -0.06975647374412552, -0.05233595624294381,
    -0.03489949670250114, -0.017452406437283435,
    0.0
};

/**
 * Cosine lookup table for the range [0..360].
 */
const float cos_table[] = {
    1.0,
    0.9998476951563913, 0.9993908270190958, 0.9986295347545738,
    0.9975640502598242, 0.9961946980917455, 0.9945218953682733,
    0.992546151641322, 0.9902680687415704, 0.9876883405951378,
    0.984807753012208, 0.981627183447664, 0.9781476007338057,
    0.9743700647852352, 0.9702957262759965, 0.9659258262890683,
    0.9612616959383189, 0.9563047559630354, 0.9510565162951535,
    0.9455185755993168, 0.9396926207859084, 0.9335804264972017,
    0.9271838545667874, 0.9205048534524404, 0.9135454576426009,
    0.9063077870366499, 0.898794046299167, 0.8910065241883679,
    0.882947592858927, 0.8746197071393957, 0.8660254037844387,
    0.8571673007021123, 0.848048096156426, 0.838670567945424,
    0.8290375725550416, 0.8191520442889918, 0.8090169943749475,
    0.7986355100472928, 0.7880107536067219, 0.7771459614569709,
    0.7660444431189781, 0.754709580222772, 0.7431448254773942,
    0.7313537016191705, 0.7193398003386512, 0.7071067811865476,
    0.6946583704589974, 0.6819983600624985, 0.6691306063588582,
    0.6560590289905074, 0.6427876096865394, 0.6293203910498375,
    0.6156614753256583, 0.6018150231520484, 0.5877852522924732,
    0.5735764363510462, 0.5591929034707469, 0.5446390350150271,
    0.5299192642332049, 0.5150380749100542,
    0.5,
    0.48480962024633717, 0.46947156278589086, 0.4539904997395468,
    0.4383711467890774, 0.42261826174069944, 0.40673664307580015,
    0.3907311284892737, 0.37460659341591196, 0.3583679495453004,
    0.3420201433256688, 0.32556815445715676, 0.30901699437494745,
    0.29237170472273677, 0.27563735581699916, 0.25881904510252074,
    0.24192189559966767, 0.22495105434386492, 0.20791169081775945,
    0.19080899537654492, 0.17364817766693041, 0.15643446504023092,
    0.13917310096006547, 0.12186934340514748, 0.10452846326765344,
    0.08715574274765812, 0.06975647374412523, 0.052335956242943966,
    0.03489949670250108, 0.0174524064372836,
    0.0,
    -0.017452406437283473, -0.034899496702500955, -0.05233595624294384,
    -0.06975647374412534, -0.08715574274765824, -0.10452846326765355,
    -0.12186934340514738, -0.13917310096006535, -0.1564344650402308,
    -0.1736481776669303, -0.1908089953765448, -0.20791169081775934,
    -0.22495105434386503, -0.24192189559966779, -0.25881904510252085,
    -0.27563735581699905, -0.29237170472273666, -0.30901699437494734,
    -0.32556815445715664, -0.3420201433256687, -0.35836794954530027,
    -0.37460659341591207, -0.3907311284892738, -0.40673664307580026,
    -0.42261826174069933, -0.4383711467890775, -0.45399049973954675,
    -0.4694715627858909, -0.48480962024633695,
    -0.5,
    -0.5150380749100542, -0.5299192642332048, -0.5446390350150271,
    -0.5591929034707467, -0.5735764363510462, -0.587785252292473,
    -0.6018150231520484, -0.6156614753256582, -0.6293203910498373,
    -0.6427876096865393, -0.6560590289905072, -0.6691306063588582,
    -0.6819983600624984, -0.6946583704589974, -0.7071067811865475,
    -0.7193398003386513, -0.7313537016191705, -0.743144825477394,
    -0.754709580222772, -0.7660444431189779, -0.7771459614569709,
    -0.7880107536067219, -0.7986355100472929, -0.8090169943749473,
    -0.8191520442889919, -0.8290375725550416, -0.8386705679454239,
    -0.848048096156426, -0.8571673007021121, -0.8660254037844387,
    -0.8746197071393957, -0.882947592858927, -0.8910065241883678,
    -0.898794046299167, -0.9063077870366499, -0.9135454576426008,
    -0.9205048534524404, -0.9271838545667873, -0.9335804264972017,
    -0.9396926207859083, -0.9455185755993168, -0.9510565162951535,
    -0.9563047559630355, -0.9612616959383189, -0.9659258262890682,
    -0.9702957262759965, -0.9743700647852351, -0.9781476007338057,
    -0.981627183447664, -0.9848077530122081, -0.9876883405951377,
    -0.9902680687415704, -0.992546151641322, -0.9945218953682733,
    -0.9961946980917455, -0.9975640502598242, -0.9986295347545738,
    -0.9993908270190958, -0.9998476951563913,
    -1.0,
    -0.9998476951563913, -0.9993908270190958, -0.9986295347545738,
    -0.9975640502598242, -0.9961946980917455, -0.9945218953682733,
    -0.9925461516413221, -0.9902680687415703, -0.9876883405951378,
    -0.984807753012208, -0.981627183447664, -0.9781476007338056,
    -0.9743700647852352, -0.9702957262759965, -0.9659258262890683,
    -0.9612616959383189, -0.9563047559630354, -0.9510565162951536,
    -0.9455185755993167, -0.9396926207859084, -0.9335804264972016,
    -0.9271838545667874, -0.9205048534524404, -0.9135454576426009,
    -0.90630778703665, -0.8987940462991669, -0.8910065241883679,
    -0.8829475928589269, -0.8746197071393959, -0.8660254037844386,
    -0.8571673007021123, -0.8480480961564261, -0.838670567945424,
    -0.8290375725550418, -0.8191520442889917, -0.8090169943749475,
    -0.7986355100472928, -0.788010753606722, -0.7771459614569708,
    -0.7660444431189781, -0.7547095802227721, -0.7431448254773942,
    -0.7313537016191707, -0.7193398003386511, -0.7071067811865477,
    -0.6946583704589973, -0.6819983600624986, -0.6691306063588581,
    -0.6560590289905074, -0.6427876096865396, -0.6293203910498378,
    -0.6156614753256582, -0.6018150231520483, -0.5877852522924732,
    -0.5735764363510464, -0.5591929034707466, -0.544639035015027,
    -0.529919264233205, -0.5150380749100545,
    -0.5,
    -0.48480962024633684, -0.46947156278589075, -0.4539904997395469,
    -0.43837114678907774, -0.4226182617406991, -0.4067366430758001,
    -0.3907311284892738, -0.3746065934159123, -0.3583679495453007,
    -0.3420201433256685, -0.32556815445715664, -0.30901699437494756,
    -0.29237170472273705, -0.2756373558169989, -0.25881904510252063,
    -0.2419218955996678, -0.22495105434386528, -0.20791169081775981,
    -0.1908089953765446, -0.17364817766693033, -0.15643446504023106,
    -0.13917310096006583, -0.12186934340514717, -0.10452846326765335,
    -0.08715574274765825, -0.06975647374412558, -0.052335956242944306,
    -0.034899496702500754, -0.017452406437283498,
    0.0,
    0.01745240643728313, 0.03489949670250128, 0.052335956242943946,
    0.06975647374412522, 0.08715574274765789, 0.104528463267653,
    0.12186934340514768, 0.13917310096006544, 0.15643446504023067,
    0.17364817766692997, 0.1908089953765451, 0.20791169081775943,
    0.2249510543438649, 0.24192189559966742, 0.2588190451025203,
    0.2756373558169994, 0.29237170472273677, 0.30901699437494723,
    0.3255681544571563, 0.34202014332566905, 0.3583679495453004,
    0.37460659341591196, 0.3907311284892735, 0.40673664307579976,
    0.4226182617406996, 0.4383711467890774, 0.45399049973954664,
    0.4694715627858904, 0.4848096202463372,
    0.5,
    0.515038074910054, 0.5299192642332047, 0.5446390350150266,
    0.559192903470747, 0.573576436351046, 0.5877852522924729,
    0.6018150231520479, 0.6156614753256585, 0.6293203910498375,
    0.6427876096865393, 0.656059028990507, 0.6691306063588578,
    0.6819983600624986, 0.6946583704589973, 0.7071067811865475,
    0.7193398003386509, 0.7313537016191707, 0.7431448254773942,
    0.7547095802227719, 0.7660444431189779, 0.7771459614569706,
    0.788010753606722, 0.7986355100472928, 0.8090169943749473,
    0.8191520442889916, 0.8290375725550418, 0.838670567945424,
    0.8480480961564258, 0.8571673007021121, 0.8660254037844384,
    0.8746197071393959, 0.882947592858927, 0.8910065241883678,
    0.8987940462991668, 0.90630778703665, 0.913545457642601,
    0.9205048534524403, 0.9271838545667873, 0.9335804264972015,
    0.9396926207859084, 0.9455185755993168, 0.9510565162951535,
    0.9563047559630353, 0.9612616959383189, 0.9659258262890683,
    0.9702957262759965, 0.9743700647852351, 0.9781476007338056,
    0.981627183447664, 0.984807753012208, 0.9876883405951377,
    0.9902680687415703, 0.9925461516413221, 0.9945218953682733,
    0.9961946980917455, 0.9975640502598242, 0.9986295347545738,
    0.9993908270190958, 0.9998476951563913,
    1.0
};

/**
 * Ensure that a degree value is within [0..360].
 */
extern inline int deg_range(int val) {
    while (val < 0) {
        val += 360;
    }
    while (val > 360) {
        val -= 360;
    }
    return val;
}

/**
 * Returns cos() of a degree value. Uses a lookup table for speed.
 * This function only takes degrees in the range [0..360].
 */
extern inline float degcos(int deg) {
    return cos_table[deg];
}

/**
 * Returns sin() of a degree value. Uses a lookup table for speed.
 * This function only takes degrees in the range [0..360].
 */
extern inline float degsin(int deg) {
    return sin_table[deg];
}
